<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Carrier Dashboard – RoYo Logistics</title>
  <link rel="stylesheet" href="styles.css" />
</head>
<body>

  <main class="container" style="padding: 80px 20px; max-width: 1100px;">
    <div style="display:flex; align-items:center; gap:12px;">
      <h1 data-i18n="title">Carrier Dashboard</h1>
      <span id="userEmail" style="margin-left:auto; color:#cbd5e1;"></span>
      <button id="logoutBtn" type="button" class="btn ghost" data-i18n="logout">Logout</button>
    </div>

    <!-- Language switch -->
    <div style="display:flex; gap:10px; margin: 14px 0 26px;">
      <button type="button" class="lang-btn active" data-lang="en">EN</button>
      <button type="button" class="lang-btn" data-lang="ru">RU</button>
      <button type="button" class="lang-btn" data-lang="uz">UZ</button>
    </div>

    <p class="subtitle" data-i18n="subtitle">Welcome to your carrier workspace</p>

    <div class="dashboard-grid">
      <div class="dashboard-card">
        <h3 data-i18n="card_profile">Carrier Profile</h3>
        <p data-i18n="card_profile_desc">Manage company info, MC/DOT, insurance, and contact details.</p>
        <button data-i18n="btn_open">Open</button>
      </div>

      <div class="dashboard-card">
        <h3 data-i18n="card_loads">Available Loads</h3>
        <p data-i18n="card_loads_desc">Browse and accept available shipments in real time.</p>
        <button data-i18n="btn_view_loads">View Loads</button>
      </div>

      <div class="dashboard-card">
        <h3 data-i18n="card_shipments">My Shipments</h3>
        <p data-i18n="card_shipments_desc">Track active, completed, and pending loads.</p>
        <button data-i18n="btn_track">Track</button>
      </div>

      <div class="dashboard-card">
        <h3 data-i18n="card_docs">Documents</h3>
        <p data-i18n="card_docs_desc">Upload insurance, W-9, and compliance documents.</p>
        <button data-i18n="btn_upload">Upload</button>
      </div>

      <div class="dashboard-card">
        <h3 data-i18n="card_payments">Payments</h3>
        <p data-i18n="card_payments_desc">View payment history and upcoming settlements.</p>
        <button data-i18n="btn_view">View</button>
      </div>

      <div class="dashboard-card">
        <h3 data-i18n="card_support">Support</h3>
        <p data-i18n="card_support_desc">Contact dispatch or account support.</p>
        <button data-i18n="btn_contact">Contact</button>
      </div>
    </div>

    <a href="index.html" style="display:inline-block;margin-top:40px;" data-i18n="back_home">← Back to Home</a>
  </main>

  <!-- AUTH + ROLE PROTECTION (carrier only) -->
  <script type="module">
    import { auth, db } from "./firebase.js";
    import { onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.14.1/firebase-auth.js";
    import { doc, getDoc } from "https://www.gstatic.com/firebasejs/10.14.1/firebase-firestore.js";

    const emailEl = document.getElementById("userEmail");

    async function getRole(uid) {
      const snap = await getDoc(doc(db, "users", uid));
      return snap.exists() ? snap.data().role : null;
    }

    onAuthStateChanged(auth, async (user) => {
      if (!user) {
        window.location.replace("login.html");
        return;
      }

      emailEl.textContent = user.email ? `Logged in as: ${user.email}` : "";

      const role = await getRole(user.uid);
      if (role !== "carrier") {
        window.location.replace("login.html");
      }
    });

    document.getElementById("logoutBtn").addEventListener("click", async () => {
      await signOut(auth);
      window.location.replace("login.html");
    });
  </script>

  <!-- i18n -->
  <script>
    const i18n = {
      en: {
        title: "Carrier Dashboard",
        logout: "Logout",
        subtitle: "Welcome to your carrier workspace",
        card_profile: "Carrier Profile",
        card_profile_desc: "Manage company info, MC/DOT, insurance, and contact details.",
        card_loads: "Available Loads",
        card_loads_desc: "Browse and accept available shipments in real time.",
        card_shipments: "My Shipments",
        card_shipments_desc: "Track active, completed, and pending loads.",
        card_docs: "Documents",
        card_docs_desc: "Upload insurance, W-9, and compliance documents.",
        card_payments: "Payments",
        card_payments_desc: "View payment history and upcoming settlements.",
        card_support: "Support",
        card_support_desc: "Contact dispatch or account support.",
        btn_open: "Open",
        btn_view_loads: "View Loads",
        btn_track: "Track",
        btn_upload: "Upload",
        btn_view: "View",
        btn_contact: "Contact",
        back_home: "← Back to Home"
      },
      ru: {
        title: "Кабинет перевозчика",
        logout: "Выйти",
        subtitle: "Добро пожаловать в рабочее пространство перевозчика",
        card_profile: "Профиль перевозчика",
        card_profile_desc: "Управляйте данными компании, MC/DOT, страховкой и контактами.",
        card_loads: "Доступные грузы",
        card_loads_desc: "Просматривайте и принимайте перевозки в реальном времени.",
        card_shipments: "Мои перевозки",
        card_shipments_desc: "Отслеживайте активные, завершённые и ожидающие рейсы.",
        card_docs: "Документы",
        card_docs_desc: "Загружайте страховку, W-9 и документы по комплаенсу.",
        card_payments: "Платежи",
        card_payments_desc: "Смотрите историю выплат и предстоящие расчёты.",
        card_support: "Поддержка",
        card_support_desc: "Свяжитесь с диспетчером или службой поддержки.",
        btn_open: "Открыть",
        btn_view_loads: "Смотреть грузы",
        btn_track: "Отслеживать",
        btn_upload: "Загрузить",
        btn_view: "Смотреть",
        btn_contact: "Связаться",
        back_home: "← На главную"
      },
      uz: {
        title: "Tashuvchi paneli",
        logout: "Chiqish",
        subtitle: "Tashuvchi ish maydoniga xush kelibsiz",
        card_profile: "Tashuvchi profili",
        card_profile_desc: "Kompaniya ma’lumotlari, MC/DOT, sug‘urta va kontaktlarni boshqaring.",
        card_loads: "Mavjud yuklar",
        card_loads_desc: "Yuklarni ko‘ring va real vaqtda qabul qiling.",
        card_shipments: "Mening yuklarim",
        card_shipments_desc: "Faol, yakunlangan va kutilayotgan yuklarni kuzating.",
        card_docs: "Hujjatlar",
        card_docs_desc: "Sug‘urta, W-9 va moslik (compliance) hujjatlarini yuklang.",
        card_payments: "To‘lovlar",
        card_payments_desc: "To‘lovlar tarixini va yaqin to‘lovlarni ko‘ring.",
        card_support: "Yordam",
        card_support_desc: "Dispetcher yoki qo‘llab-quvvatlash bilan bog‘laning.",
        btn_open: "Ochish",
        btn_view_loads: "Yuklarni ko‘rish",
        btn_track: "Kuzatish",
        btn_upload: "Yuklash",
        btn_view: "Ko‘rish",
        btn_contact: "Bog‘lanish",
        back_home: "← Bosh sahifaga"
      }
    };

    function applyLang(lang) {
      const dict = i18n[lang] || i18n.en;

      document.querySelectorAll("[data-i18n]").forEach(el => {
        const key = el.getAttribute("data-i18n");
        if (dict[key]) el.textContent = dict[key];
      });

      document.querySelectorAll(".lang-btn").forEach(b => {
        b.classList.toggle("active", b.dataset.lang === lang);
      });

      localStorage.setItem("lang", lang);
    }

    document.querySelectorAll(".lang-btn").forEach(btn => {
      btn.addEventListener("click", () => applyLang(btn.dataset.lang));
    });

    applyLang(localStorage.getItem("lang") || "en");
  </script>

</body>
</html>
